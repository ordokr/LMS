<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LMS Integration Project - Central Reference Hub Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; line-height: 1.6; padding: 20px; max-width: 1200px; margin: auto; background-color: #f8f9fa; color: #212529; }
        h1, h2, h3, h4, h5, h6 { color: #0056b3; border-bottom: 1px solid #dee2e6; padding-bottom: 5px; margin-top: 1.5em; }
        h1 { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #0056b3; }
        section { background-color: #fff; padding: 25px; margin-bottom: 25px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.05); }
        pre { background-color: #e9ecef; padding: 15px; border-radius: 5px; overflow-x: auto; font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace; border: 1px solid #ced4da; }
        code:not(pre > code) { background-color: #e9ecef; padding: 0.2em 0.4em; margin: 0; font-size: 85%; border-radius: 3px; font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        th, td { border: 1px solid #dee2e6; padding: 10px 12px; text-align: left; vertical-align: top; }
        th { background-color: #f1f3f5; font-weight: 600; }
        tr:nth-child(even) { background-color: #f8f9fa; }
        tr:hover { background-color: #e9ecef; }
        ul, ol { margin-left: 20px; padding-left: 10px; }
        li { margin-bottom: 8px; }
        blockquote { border-left: 4px solid #ced4da; padding-left: 15px; color: #6c757d; margin-left: 0; font-style: italic; }
        .mermaid { text-align: center; margin-top: 25px; background-color: #fff; padding: 15px; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        /* Status and Priority Styling */
        .status-ok { color: #28a745; font-weight: bold; } /* Green */
        .status-partial { color: #fd7e14; font-weight: bold; } /* Orange */
        .status-error { color: #dc3545; font-weight: bold; } /* Red */
        .priority-high { font-weight: bold; color: #dc3545; }
        .priority-medium { font-weight: bold; color: #ffc107; }
        .priority-low { font-weight: bold; color: #28a745; }
        /* Add styles for sections based on h2 IDs */
        #overview, #mapping, #conflicts, #tasks, #structure, #details, #meilisearch, #architecture, #key-integration-points, #project-trajectories {
            /* Add specific styles if needed, or just use the section tag */
        }
        /* Style tables within specific sections if needed */
        #mapping table td:nth-child(5), #mapping table td:nth-child(6),
        #details table:nth-of-type(1) td:nth-child(3),
        #details table:nth-of-type(2) td:nth-child(4),
        #details table:nth-of-type(3) td:nth-child(3) {
            text-align: center; /* Center status/priority columns */
        }
        /* New styles for the SOLID principles and design patterns */
        .code-quality-section {
            background-color: #f8f9fa;
            border-left: 4px solid #0056b3;
        }
        
        .principles-table {
            margin-top: 15px;
        }
        
        .violation-count {
            font-weight: bold;
            text-align: center;
            border-radius: 4px;
        }
        
        .implementation-count {
            font-weight: bold;
            text-align: center;
            border-radius: 4px;
        }
        
        .metrics-summary {
            animation: fadeIn 0.5s ease-in;
        }
        
        .metric-card {
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1) !important;
        }
        
        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(-20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

    <div id="content">
        <h1>Loading Dashboard...</h1>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({ startOnLoad: false, theme: 'default' });

        // Function to apply custom styling/logic after markdown is rendered
        function postProcessContent() {
            // Add status/priority classes to table cells based on content
            const statusCells = document.querySelectorAll('td');
            statusCells.forEach(cell => {
                const text = cell.textContent.trim();
                if (text.includes('âœ…')) cell.classList.add('status-ok');
                if (text.includes('âš ï¸') || text.includes('%')) { // Assuming % indicates partial completion
                   if (!text.includes('100%')) cell.classList.add('status-partial');
                   else if (text.includes('100%')) cell.classList.add('status-ok'); // Handle 100% explicitly
                }
                if (text.includes('âŒ')) cell.classList.add('status-error');
                if (text.toLowerCase().includes('high')) cell.classList.add('priority-high');
                if (text.toLowerCase().includes('medium')) cell.classList.add('priority-medium');
                if (text.toLowerCase().includes('low')) cell.classList.add('priority-low');

                // Clean up icons if needed
                cell.innerHTML = cell.innerHTML.replace(/âœ…|âš ï¸|âŒ|ðŸ”´/g, '').trim();
            });

            // Add styling for SOLID principles and design patterns sections
            const headings = document.querySelectorAll('h3');
            headings.forEach(heading => {
                if (heading.textContent.includes('SOLID Principles') || heading.textContent.includes('Design Patterns')) {
                    // Find the next table
                    let table = heading.nextElementSibling;
                    while (table && table.tagName !== 'TABLE') {
                        table = table.nextElementSibling;
                    }
                    
                    if (table) {
                        // Add special styling for the principles/patterns tables
                        table.classList.add('principles-table');
                        
                        // Style the table cells
                        const rows = table.querySelectorAll('tr');
                        rows.forEach(row => {
                            const cells = row.querySelectorAll('td');
                            if (cells.length >= 2) {
                                const numericCell = heading.textContent.includes('Design Patterns') ? cells[1] : cells[1];
                                const count = parseInt(numericCell.textContent.trim());
                                
                                if (!isNaN(count) && count > 0) {
                                    numericCell.classList.add('violation-count');
                                    
                                    // Different styling based on section
                                    if (heading.textContent.includes('Design Patterns')) {
                                        // Implementation count for design patterns
                                        if (cells[1] === numericCell) {
                                            numericCell.classList.add('implementation-count');
                                            numericCell.style.backgroundColor = `rgba(40, 167, 69, ${Math.min(count / 10, 0.8)})`;
                                            numericCell.style.color = count > 5 ? '#fff' : '#000';
                                        } 
                                        // Violation count for design patterns
                                        if (cells[2] && cells[2].textContent.trim().match(/^\d+$/)) {
                                            const violations = parseInt(cells[2].textContent.trim());
                                            if (violations > 0) {
                                                cells[2].classList.add('violation-count');
                                                cells[2].style.backgroundColor = `rgba(220, 53, 69, ${Math.min(violations / 10, 0.8)})`;
                                                cells[2].style.color = violations > 5 ? '#fff' : '#000';
                                            }
                                        }
                                    } else {
                                        // SOLID principles violations
                                        numericCell.style.backgroundColor = `rgba(220, 53, 69, ${Math.min(count / 10, 0.8)})`;
                                        numericCell.style.color = count > 5 ? '#fff' : '#000';
                                    }
                                }
                            }
                        });
                    }
                }
            });

            // Wrap content under H2s in sections
            const contentDiv = document.getElementById('content');
            const h2Headings = contentDiv.querySelectorAll('h2');
            h2Headings.forEach(h2 => {
                // Skip if already in a section
                if (h2.parentElement.tagName === 'SECTION') {
                    return;
                }

                const section = document.createElement('section');
                const sectionId = h2.textContent.trim().toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-+|-+$/g, '');
                section.id = sectionId || 'section-' + Math.random().toString(36).substring(7); // Fallback ID
                
                // Special styling for SOLID principles section
                if (h2.textContent.includes('SOLID') || h2.textContent.includes('Principles') || 
                    h2.textContent.includes('Violations') || h2.textContent.includes('Design Patterns')) {
                    section.classList.add('code-quality-section');
                }
                
                contentDiv.insertBefore(section, h2);
                section.appendChild(h2);
                let sibling = section.nextElementSibling;
                while (sibling && sibling.tagName !== 'H2') {
                    const nextSibling = sibling.nextElementSibling;
                    section.appendChild(sibling);
                    sibling = nextSibling;
                }
            });

            // Move H1 outside sections
            const h1 = contentDiv.querySelector('h1');
            if (h1) {
                contentDiv.parentNode.insertBefore(h1, contentDiv);
            }
            
            // Move intro paragraph outside sections
            const introP = contentDiv.querySelector('p');
            if (introP && introP.textContent.includes('Last updated')) {
                contentDiv.parentNode.insertBefore(introP, contentDiv);
            }

            // Render Mermaid diagrams
            mermaid.run({
                nodes: document.querySelectorAll('.mermaid')
            });
            
            // Create project health indicators based on metrics
            createProjectHealthIndicators();
        }

        // Add function to create project health indicators
        function createProjectHealthIndicators() {
            const projectStats = {};
            
            // Extract metrics from the page
            document.querySelectorAll('pre code').forEach(code => {
                if (code.textContent.includes('project_stats')) {
                    try {
                        const jsonText = code.textContent;
                        const jsonData = JSON.parse(jsonText);
                        
                        if (jsonData.project_stats) {
                            Object.assign(projectStats, jsonData.project_stats);
                        }
                    } catch (e) {
                        console.error('Error parsing JSON metrics:', e);
                    }
                }
            });
            
            // Only proceed if we have stats
            if (Object.keys(projectStats).length === 0) {
                return;
            }
            
            // Create a metrics summary section at the top
            const metricsDiv = document.createElement('div');
            metricsDiv.className = 'metrics-summary';
            metricsDiv.style.display = 'flex';
            metricsDiv.style.flexWrap = 'wrap';
            metricsDiv.style.gap = '15px';
            metricsDiv.style.justifyContent = 'center';
            metricsDiv.style.marginBottom = '30px';
            
            // Add a metric card for each key stat
            for (const [key, value] of Object.entries(projectStats)) {
                const card = document.createElement('div');
                card.className = 'metric-card';
                card.style.padding = '15px';
                card.style.borderRadius = '8px';
                card.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
                card.style.width = '180px';
                card.style.textAlign = 'center';
                card.style.backgroundColor = '#fff';
                
                // Format the label
                const label = key.replace(/_/g, ' ').split(' ')
                    .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                    .join(' ');
                    
                // Determine color based on value
                let color = '#0056b3'; // Default blue
                if (typeof value === 'string' && value.includes('%')) {
                    const percentage = parseInt(value);
                    if (percentage < 30) color = '#dc3545'; // Red for low %
                    else if (percentage < 70) color = '#fd7e14'; // Orange for medium %
                    else color = '#28a745'; // Green for high %
                }
                
                card.innerHTML = `
                    <h4 style="margin-top:0;border-bottom:none;color:#495057;font-size:16px;font-weight:normal">${label}</h4>
                    <div style="font-size:24px;font-weight:bold;margin:10px 0;color:${color}">${value}</div>
                `;
                
                metricsDiv.appendChild(card);
            }
            
            // Add the metrics before the first section
            const firstSection = document.querySelector('section');
            if (firstSection) {
                firstSection.parentNode.insertBefore(metricsDiv, firstSection);
            }
        }

        // Add this utility function to help with content selection
        // Add a contains selector for finding elements by text content
        if (!Element.prototype.matches) {
            Element.prototype.matches = Element.prototype.msMatchesSelector || 
                                      Element.prototype.webkitMatchesSelector;
        }

        // Add this helper function instead
        function findElementsWithText(selector, text) {
            const elements = document.querySelectorAll(selector);
            return Array.from(elements).filter(element => 
                element.textContent.includes(text)
            );
        }

        // Define an array of possible paths to try
        const pathsToTry = [
            '/LMS/docs/central_reference_hub.md',
            '../docs/central_reference_hub.md',
            '/docs/central_reference_hub.md',
            './docs/central_reference_hub.md'
        ];

        // Create a function to try loading from each path
        function tryLoadMarkdown(pathIndex) {
            if (pathIndex >= pathsToTry.length) {
                // We've tried all paths and none worked
                document.getElementById('content').innerHTML = `
                    <h1>Error loading dashboard</h1>
                    <p>Could not load the central reference hub. All paths have been tried.</p>
                    <div style="margin-top:20px;padding:15px;background-color:#f8f9fa;border-left:4px solid #6c757d;">
                        <h3>Troubleshooting Steps:</h3>
                        <p>The following paths were tried:</p>
                        <ul>
                            ${pathsToTry.map(path => `<li>${path}</li>`).join('')}
                        </ul>
                        <p>Please verify the file exists at: <code>c:\\Users\\Tim\\Desktop\\LMS\\docs\\central_reference_hub.md</code></p>
                        <p>You could also try:</p>
                        <ol>
                            <li>Check file permissions</li>
                            <li>Restart the http-server</li>
                            <li>Try running the server from C:\\Users\\Tim\\Desktop\\LMS instead</li>
                        </ol>
                    </div>
                `;
                return;
            }
            
            const currentPath = pathsToTry[pathIndex];
            console.log(`Trying to fetch from: ${currentPath}`);
            
            fetch(currentPath)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    console.log(`Success with path: ${currentPath}`);
                    return response.text();
                })
                .then(markdown => {
                    // Parse the Markdown content to HTML
                    let htmlContent = marked.parse(markdown);
                    document.getElementById('content').innerHTML = htmlContent;
                    
                    // Apply custom styling and processing
                    postProcessContent();
                    
                    // Display which path worked (for debugging)
                    console.log(`Successfully loaded markdown from: ${currentPath}`);
                    const debugElement = document.createElement('div');
                    debugElement.style.padding = '10px';
                    debugElement.style.backgroundColor = '#e8f5e9';
                    debugElement.style.color = '#2e7d32';
                    debugElement.style.position = 'fixed';
                    debugElement.style.bottom = '10px';
                    debugElement.style.right = '10px';
                    debugElement.style.borderRadius = '5px';
                    debugElement.style.fontSize = '12px';
                    debugElement.textContent = `Loaded from: ${currentPath}`;
                    document.body.appendChild(debugElement);
                })
                .catch(error => {
                    console.error(`Failed with path ${currentPath}:`, error);
                    // Try the next path
                    tryLoadMarkdown(pathIndex + 1);
                });
        }

        // Start trying from the first path
        tryLoadMarkdown(0);
    </script>

</body>
</html>